#!/bin/bash

if [[ -e /etc/redhat-release ]]; then
	if grep -q "CentOS" /etc/redhat-release; then
		# EX: CentOS release 6.5 (Final)
		DISTRO="CentOS"
		ID="centos"
	elif grep -q "Red Hat" /etc/redhat-release; then
		# EX: Red Hat Enterprise Linux Server release 6.5 (Santiago)
		DISTRO="Redhat"
		ID="el"
	else
		echo "unknown EL clone"
		exit 1
	fi
	RELEASE=$(tr -cd "[:digit:]." < /etc/redhat-release)
else
	echo "not an EL distro"
	exit 1
fi

ARCH=$(uname -m)
case ${ARCH} in
	i486)	ARCH="i386";;
	i586)	ARCH="i386";;
	i686)	ARCH="i386";;
esac

echo "detected ${DISTRO} ${RELEASE} ${ARCH}"

case ${RELEASE} in
	5*)
		rpm -Uvh http://mirror.rackspace.com/centos/5/extras/${ARCH}/RPMS/epel-release-5-4.noarch.rpm
		rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL
		rpm -Uvh http://mirror.rackspace.com/ius/stable/${DISTRO}/5/${ARCH}/ius-release-1.0-13.ius.${ID}5.noarch.rpm
		rpm --import /etc/pki/rpm-gpg/IUS-COMMUNITY-GPG-KEY
	;;
	6*)
		rpm -Uvh http://mirror.rackspace.com/centos/6/extras/${ARCH}/Packages/epel-release-6-8.noarch.rpm
		rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6
		rpm -Uvh http://mirror.rackspace.com/ius/stable/${DISTRO}/6/${ARCH}/ius-release-1.0-13.ius.${ID}6.noarch.rpm
		rpm --import /etc/pki/rpm-gpg/IUS-COMMUNITY-GPG-KEY
	;;
	7*)
		rpm -Uvh http://mirror.rackspace.com/centos/7/extras/${ARCH}/Packages/epel-release-7-2.noarch.rpm
		rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
		rpm -Uvh http://mirror.rackspace.com/ius/stable/${DISTRO}/7/${ARCH}/ius-release-1.0-13.ius.${ID}7.noarch.rpm
		rpm --import /etc/pki/rpm-gpg/IUS-COMMUNITY-GPG-KEY
	;;
	*)
		echo "unsupported EL version"
		exit 1
		;;
esac
